<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Antigravity • Voice Humanizer</title>
  
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Inter font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

    :root {
      --accent: #14b8a6; /* teal-500 */
    }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: #000814;
      color: #e2e8f0;
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
      padding: 2rem;
    }

    /* ==================== MOVING STARS BACKGROUND ==================== */
    .stars, .stars2, .stars3 {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      pointer-events: none;
      z-index: -2;
    }

    .stars {
      background-image: 
        radial-gradient(2px 2px at 20px 30px, #eee, transparent),
        radial-gradient(2px 2px at 40px 70px, #fff, transparent),
        radial-gradient(2px 2px at 50px 160px, #ddd, transparent),
        radial-gradient(2px 2px at 90px 40px, #fff, transparent),
        radial-gradient(2px 2px at 130px 80px, #eee, transparent);
      background-size: 200px 200px;
      animation: zoom 200s linear infinite;
      opacity: 0.85;
    }

    .stars2 {
      background-image: 
        radial-gradient(1.5px 1.5px at 30px 60px, #fff, transparent),
        radial-gradient(1.5px 1.5px at 70px 120px, #eee, transparent),
        radial-gradient(1.5px 1.5px at 110px 190px, #ddd, transparent);
      background-size: 300px 300px;
      animation: zoom 150s linear infinite reverse;
      opacity: 0.65;
    }

    .stars3 {
      background-image: 
        radial-gradient(1px 1px at 10px 20px, #fff, transparent),
        radial-gradient(1px 1px at 80px 150px, #eee, transparent),
        radial-gradient(1px 1px at 150px 90px, #ddd, transparent);
      background-size: 400px 400px;
      animation: zoom 120s linear infinite;
      opacity: 0.45;
    }

    @keyframes zoom {
      from { transform: scale(1); }
      to   { transform: scale(1.8); }
    }

    /* Modal styling */
    .upload-modal {
      background: white;
      color: #111827;
      border-radius: 24px;
      box-shadow: 0 25px 50px -12px rgb(0 0 0 / 40%);
      max-width: 800px; /* Widened slightly for controls */
      margin: 0 auto;
      overflow: hidden;
      position: relative;
      z-index: 10;
    }

    .tail-text-teal { color: #14b8a6; }
    .progress-blue { background: linear-gradient(to right, #3b82f6, #60a5fa); }
    .progress-cyan { background: linear-gradient(to right, #06b6d4, #67e8f9); }
    .progress-red { background: #ef4444; }
  </style>
</head>
<body>

  <!-- Moving Stars Background -->
  <div class="stars"></div>
  <div class="stars2"></div>
  <div class="stars3"></div>

  <!-- Main Container -->
  <div class="max-w-4xl mx-auto mt-12 space-y-8">
      
      <!-- Upload Modal -->
      <div class="upload-modal">
        <!-- Header -->
        <div class="flex items-center justify-between px-8 py-6 border-b border-gray-100">
          <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded-lg bg-teal-500 flex items-center justify-center">
                  <span class="text-white font-bold text-lg">A</span>
              </div>
              <h1 class="text-2xl font-semibold text-gray-900">Antigravity Input</h1>
          </div>
          <!-- Voice Controls (Added for Antigravity) -->
          <div class="flex gap-2">
             <select id="emotion-select" class="bg-gray-50 border border-gray-200 text-gray-900 text-sm rounded-lg focus:ring-teal-500 focus:border-teal-500 block px-4 py-2">
                <option value="calm">Calm</option>
                <option value="excited">Excited</option>
                <option value="suspense">Suspense</option>
                <option value="sad">Sad</option>
                <option value="confident">Confident</option>
                <option value="storytelling">Storytelling</option>
             </select>
          </div>
        </div>

        <div class="flex flex-col md:flex-row">
          <!-- Left: Drop Zone -->
          <div class="flex-1 p-10 border-r border-gray-100">
            <div id="drop-zone"
                 class="border-2 border-dashed border-teal-400 rounded-3xl h-80 flex flex-col items-center justify-center bg-teal-50 hover:bg-teal-100 transition-colors cursor-pointer"
                 onclick="triggerFileInput()">
              <!-- Cloud Icon -->
              <svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 text-teal-500 mb-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75" 
                      d="M4 16v-4m0 0l4 4m-4-4l4-4m12 8v-4m0 0l-4 4m4-4l-4-4" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" 
                      d="M3 15v-3a2 2 0 012-2h.5a2 2 0 012-2H18a2 2 0 012 2v3" />
              </svg>
              
              <p class="text-xl text-gray-700 font-medium mb-1">Drag audio to upload</p>
              <p class="text-gray-500 mb-6">or click to browse</p>
              
              <button class="bg-teal-500 hover:bg-teal-600 transition-colors text-white px-8 py-3 rounded-full font-semibold flex items-center gap-2">
                <span>Browse Files</span>
              </button>

              <div class="mt-8 text-xs text-gray-400 text-center">
                Max file size: 50MB<br>
                Supported: WAV, MP3
              </div>
            </div>
            <form id="upload-form" action="/upload" method="post" enctype="multipart/form-data" class="hidden">
                 <input type="file" id="file-input" name="file" accept=".wav,.mp3" onchange="handleFileSelect(this)">
            </form>
          </div>

          <!-- Right: Files List / Status -->
          <div class="w-full md:w-80 bg-white p-6 space-y-6 overflow-auto" style="max-height: 520px;" id="file-list">
            
            <!-- Empty State -->
            <div id="empty-state" class="text-center text-gray-400 mt-10">
                <p>No files processed yet.</p>
            </div>

            <!-- Template for File Item (Hidden) -->
            <div id="file-item-template" class="hidden flex items-start gap-4">
              <div class="w-10 h-10 rounded-2xl bg-cyan-100 flex items-center justify-center flex-shrink-0 status-icon">
                <span class="text-cyan-600 text-2xl">⟳</span>
              </div>
              <div class="flex-1 min-w-0">
                <div class="flex justify-between items-start">
                  <div>
                    <p class="font-medium text-gray-800 truncate filename">filename.mp3</p>
                    <p class="text-xs text-gray-500 filesize">0MB</p>
                  </div>
                  <span class="text-cyan-600 text-xs font-medium status-text">Processing...</span>
                </div>
                <div class="h-1.5 bg-gray-100 rounded-full mt-3 overflow-hidden">
                  <div class="progress-bar progress-cyan h-full w-0 rounded-full"></div>
                </div>
                <div class="mt-2 hidden result-actions">
                    <audio controls class="w-full h-8 mt-1 block"></audio>
                    <a href="#" download class="text-xs text-teal-600 hover:underline mt-1 block">Download Result</a>
                </div>
              </div>
            </div>

          </div>
        </div>

        <!-- Footer hint -->
        <div class="px-8 py-4 text-xs text-gray-400 border-t border-gray-100 flex items-center justify-between">
          <span>Antigravity AI Engine v0.1</span>
          <span class="text-teal-600 cursor-pointer hover:underline" onclick="clearAll()">Clear all</span>
        </div>
      </div>
  </div>

  <script>
    function triggerFileInput() {
      document.getElementById('file-input').click();
    }

    function handleFileSelect(input) {
        if (input.files && input.files[0]) {
            uploadFile(input.files[0]);
        }
    }

    const dropZone = document.getElementById('drop-zone');
    dropZone.addEventListener('dragover', e => {
      e.preventDefault();
      dropZone.classList.add('!border-teal-600', '!bg-teal-100');
    });
    dropZone.addEventListener('dragleave', () => {
      dropZone.classList.remove('!border-teal-600', '!bg-teal-100');
    });
    dropZone.addEventListener('drop', e => {
      e.preventDefault();
      dropZone.classList.remove('!border-teal-600', '!bg-teal-100');
      if (e.dataTransfer.files && e.dataTransfer.files[0]) {
          uploadFile(e.dataTransfer.files[0]);
      }
    });

    function uploadFile(file) {
        // Hide empty state
        document.getElementById('empty-state').classList.add('hidden');

        // Clone template
        const template = document.getElementById('file-item-template');
        const item = template.cloneNode(true);
        item.id = '';
        item.classList.remove('hidden');
        
        // Set file info
        item.querySelector('.filename').textContent = file.name;
        item.querySelector('.filesize').textContent = (file.size / (1024 * 1024)).toFixed(2) + ' MB';
        
        // Add to list
        const list = document.getElementById('file-list');
        list.insertBefore(item, list.firstChild);

        // Simulate Upload / Send to Backend
        const formData = new FormData();
        formData.append('file', file);
        formData.append('emotion', document.getElementById('emotion-select').value);

        // Animate progress (fake for now, or real XHR)
        const progressBar = item.querySelector('.progress-bar');
        progressBar.style.width = '100%'; // Assume fast upload for local

        // Real fetch to backend
        fetch('/process', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                // Update UI to success
                const icon = item.querySelector('.status-icon');
                icon.classList.remove('bg-cyan-100');
                icon.classList.add('bg-blue-100');
                icon.innerHTML = '<span class="text-blue-600 text-2xl">✓</span>';
                
                item.querySelector('.status-text').textContent = 'Completed';
                item.querySelector('.status-text').classList.replace('text-cyan-600', 'text-blue-600');
                
                item.querySelector('.progress-bar').classList.replace('progress-cyan', 'progress-blue');
                
                // Show Audio Player
                const actions = item.querySelector('.result-actions');
                actions.classList.remove('hidden');
                actions.querySelector('audio').src = data.url;
                actions.querySelector('a').href = data.url;
            } else {
                 throw new Error(data.message);
            }
        })
        .catch(error => {
            console.error(error);
            const icon = item.querySelector('.status-icon');
            icon.classList.remove('bg-cyan-100');
            icon.classList.add('bg-red-100');
            icon.innerHTML = '<span class="text-red-600 text-2xl">!</span>';
            item.querySelector('.status-text').textContent = 'Error';
            item.querySelector('.status-text').classList.replace('text-cyan-600', 'text-red-600');
            item.querySelector('.progress-bar').classList.replace('progress-cyan', 'progress-red');
        });
    }

    function clearAll() {
        const list = document.getElementById('file-list');
        // Remove all items except empty state and template
        Array.from(list.children).forEach(child => {
            if (child.id !== 'empty-state' && child.id !== 'file-item-template') {
                child.remove();
            }
        });
        document.getElementById('empty-state').classList.remove('hidden');
    }
  </script>
</body>
</html>
